<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dompet Brok</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 1rem; background: #f4f4f4; }
    input, select, button { display: block; margin-top: 10px; padding: 8px; width: 100%; box-sizing: border-box; }
    .transaksi { background: white; margin-top: 10px; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .transaksi p { margin: 5px 0; }
    .header { text-align: center; margin-bottom: 20px; }
  </style>
</head>
<body>
  <div class="header">
    <h2>ðŸ“’ Dompet Brok</h2>
    <p>Catatan keuangan pribadi lo, offline + online backup ðŸ”¥</p>
  </div>

  <label>Tanggal</label>
  <input type="date" id="tanggal" />

  <label>Nominal</label>
  <input type="number" id="nominal" />

  <label>Kategori</label>
  <select id="kategori">
    <option>Pulsa</option>
    <option>Langganan</option>
    <option>Pacaran</option>
    <option>Bensin</option>
    <option>Uang Nganggur</option>
    <option>Transfer</option>
    <option>Delivery/Ojol</option>
    <option>Belanja Olshop</option>
  </select>

  <label>Dompet</label>
  <select id="dompet">
    <option>DANA</option>
    <option>GoPay</option>
    <option>SeaBank</option>
    <option>Tunai</option>
    <option>ShopeePay</option>
  </select>

  <label>Keterangan (opsional)</label>
  <input type="text" id="keterangan" />

  <button onclick="simpanTransaksi()">ðŸ’¾ Simpan Transaksi</button>
  <button onclick="syncKeSheets()">ðŸ”„ Sync ke Google Sheets</button>

  <hr />
  <h3>Riwayat Transaksi</h3>
  <div id="listTransaksi"></div>

  <script>
    const endpointSheets = "https://script.google.com/macros/s/AKfycbyBC8CVtaR-iVLcwtRJOpOicaQVlX25PVcG1ADP3udf3F_hnWqeVZqFCvEkGHaDX3hcSw/exec";

    function simpanTransaksi() {
      const data = {
        tanggal: document.getElementById("tanggal").value,
        nominal: document.getElementById("nominal").value,
        kategori: document.getElementById("kategori").value,
        dompet: document.getElementById("dompet").value,
        keterangan: document.getElementById("keterangan").value
      };

      if (!data.tanggal || !data.nominal) return alert("Tanggal dan nominal wajib diisi!");

      let transaksi = JSON.parse(localStorage.getItem("transaksiBrok") || "[]");
      transaksi.push(data);
      localStorage.setItem("transaksiBrok", JSON.stringify(transaksi));
      tampilkanTransaksi();
    }

    function tampilkanTransaksi() {
      let transaksi = JSON.parse(localStorage.getItem("transaksiBrok") || "[]");
      let html = "";
      let total = 0;
      transaksi.forEach((t, i) => {
        html += `<div class='transaksi'>
          <p><strong>${t.tanggal}</strong> - Rp${Number(t.nominal).toLocaleString()}</p>
          <p>${t.kategori} - ${t.dompet}</p>
          <p>${t.keterangan}</p>
        </div>`;
        total += Number(t.nominal);
      });
      html += `<p><strong>Total Pengeluaran:</strong> Rp${total.toLocaleString()}</p>`;
      document.getElementById("listTransaksi").innerHTML = html;
    }

    function syncKeSheets() {
      let transaksi = JSON.parse(localStorage.getItem("transaksiBrok") || "[]");
      if (!transaksi.length) return alert("Belum ada data untuk disync.");
      transaksi.forEach(t => {
        fetch(endpointSheets, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(t)
        });
      });
      alert("âœ… Data sedang dikirim ke Google Sheets!");
    }

    tampilkanTransaksi();
  </script>
</body>
</html>
